<body onload="loadColsFromDB()">
<form id="subtask_list_columns" action="subtask_list_columns">
<table>
<tr>
   <td>
     <fieldset>
        <legend>Project</legend>
     </fieldset>
   </td>
   <td> 
     <fieldset>
        <legend>Available columns</legend>
     </fieldset>
   </td>
   <td></td>
   <td>
     <fieldset>
        <legend>Selected columns</legend>
     </fieldset>
   </td>
<tr>
    <td>
<select id="selected_project_list" size="25" style="width:250px" required>
     <% @projects.each do |col| %>
            
              <option value="">
                <%= col %>
              </option>
              
              
            <% end %>

</select>
</td>
    <td>
      <select id="available_fields_list" size="25"  style="width:120px">
            <% @allColumns.each do |col| %>
              <option value="" >
                 <%= col['name'] %>
              </option>
              <% end %>
             <option> Spent time </option> 
          </select>
</td>
<td>
<input type="button" name="addItem" value=">" onclick="selectItem()">
<input type="button" name="removeItem" value="<" onclick="unselectItem()">
</td>
<td>
<select id="selected_fields_list" size="25" style="width:120px">
            <%if @inProj == true %> 
              <% @config.each do |col| %>
                <option value="" >
                   <%= col %>
                </option>
              <% end %>
            <%end%>  

</select>
</td>

</tr>
<tr>
   <td>
         <button name="save" value=1 onclick="saveAll()"><%= l(:button_save) %></button>
         <% if @currentUser != 1 && @canRestore == true %>
         <button name="restore" value=0 onclick="restoreDefaultConfig()"><%= l(:button_restore) %></button> 
         <% end %> 
         
   </td>
</tr>
</table>
<input id="selectedColumns" name="selectedColumns" type="hidden"  value="0" />
<input id="selectedProj" name="selectedProj" type="hidden"  value="0" />
<input id="projSelChange" name="projSelChange" type="hidden"  value=0 />
<input id="inProject" name="inProject" type="hidden"  value=0 />
<input id="enablePluginTab" name="enablePluginTab" type="hidden" />
<input id="restoreRequest" name="restoreRequest" type="hidden" value=0 />
<input id="fromLink" name="fromLink" type="hidden" value=0 />
</form>
<script type="text/javascript">
    function selectItem()
    {
       var availableFields = document.getElementById("available_fields_list");
       var selectedFields = document.getElementById("selected_fields_list");
       var option = document.createElement("option");
       option.text = availableFields.options[availableFields.selectedIndex].text;
       selectedFields.add(option);
       availableFields.remove(availableFields.selectedIndex);
    }
    function unselectItem()
    {
       var availableFields = document.getElementById("available_fields_list");
       var selectedFields = document.getElementById("selected_fields_list");
       var option = document.createElement("option");
       option.text = selectedFields.options[selectedFields.selectedIndex].text;
       availableFields.add(option);
       selectedFields.remove(selectedFields.selectedIndex);
    }
    function saveAll()
    {
       var selectedCols = document.getElementById('selected_fields_list').getElementsByTagName('option');
       var config = "";
       
       for(var i = 0; i < selectedCols.length; i++)
       {
           if(i != selectedCols.length -1)
           {
               config  = config + selectedCols[i].text+"|";
           }
           else
           {
               config  = config + selectedCols[i].text;
           }
       }
        
       document.getElementById('selectedColumns').value = config;
       var selectedProj = document.getElementById('selected_project_list').getElementsByTagName('option'); 
        
       
       document.getElementById('selectedProj').value = selectedProj [document.getElementById('selected_project_list').selectedIndex].text;
       if(document.getElementById('enablePluginTab').checked == true)
       { 
          document.getElementById('enablePluginTab').value = 1;  
       }
       else
       {
          document.getElementById('enablePluginTab').value = 0; 
       }
       document.forms["subtask_list_columns"].submit();
       alert("Configuration saved successfully");
       //loadColsFromDB();
       //alert("Configuration saved successfully ");     
       //window.location.href="http://192.168.1.126:3000/subtask_list_columns"
    }  
    function loadColsFromDB()
    {
        
        var firstSelect = document.getElementById("available_fields_list");
        var secondSelect = document.getElementById("selected_fields_list");
        var thirdSelect = document.getElementById("selected_project_list"); 
        var firstContent = firstSelect.getElementsByTagName("option");
        var secondContent = secondSelect.getElementsByTagName("option");  
        <% if @currentUser == 1 %>    
           var optionDef = document.createElement("option");
           optionDef.text = "Global configuration";
           thirdSelect.add(optionDef);
        <%end%> 
   
        for(var i = 0 ; i < firstContent.length ; i++)
        {
           for(var j= 0 ; j < secondContent.length ; j++)
           {
               if(firstContent[i].text == secondContent[j].text)
               {
                  firstSelect.remove(i);                  
               }
           } 
        }
        
    } 
    function restoreDefaultConfig()
    {
          <% if  @inProj == true %>
           document.getElementById('inProject').value = 1;
          <%end%>
        document.getElementById("fromLink").value = 0;   
       document.getElementById("restoreRequest").value =1;
       var selectedProj = document.getElementById('selected_project_list').getElementsByTagName('option');
       document.getElementById('selectedProj').value = selectedProj [document.getElementById('selected_project_list').selectedIndex].text;
       document.forms["subtask_list_columns"].submit();             
       alert("Default configuration was restored!");
    }
    function activateTab()
    {  <% if  @inProj == true %> 
           document.getElementById('inProject').value = 1;     
           var selectedProj = document.getElementById('selected_project_list').getElementsByTagName('option');
           document.getElementById('selectedProj').value = selectedProj [document.getElementById('selected_project_list').selectedIndex].text;
            
       <%end%> 
       <% if @tabIsEnabled == false %>
          document.getElementById("enablePluginTab").value =1;
          document.forms["subtask_list_columns"].submit();   
       <%else%>
          document.getElementById("enablePluginTab").value = 0;
          document.forms["subtask_list_columns"].submit();  
       <%end%>
    }
    function toggleText(button_id) 
    {
       var el = document.getElementById(button_id);
       <% if @tabIsEnabled == false %> 
          el.firstChild.data = "Activate tab";
          
       <%else%> 
          el.firstChild.data = "Disable tab";
       <%end%>
    }        
</script>
</body>
